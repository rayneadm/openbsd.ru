<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=koi8-r">
<meta http-equiv="Content-Language" content="ru">
<meta name="copyright" content="Copyright (c) 2005 by OpenBSD.ru">
<title>Sendmail: Поддержка Maildir с помощью Maildrop</title>
<link rel="stylesheet" type="text/css" href="style.css" tppabs="http://www.openbsd.ru/style.css">
</head>

<body>

<h2>Sendmail: Поддержка Maildir с помощью Maildrop</h2>
<hr>

<h3>Мини-руководство "шаг за шагом"</h3>

<p>
<table border=0>
<tr><td>

<p>
Устанавливаем maildrop из портов:

<pre>
# <strong>cd /usr/ports/mail/maildrop</strong>
# <strong>make install clean CLEANDEPENDS=Yes</strong>
</pre>

<p>
При необходимости компиляцию можно произвести с поддержкой LDAP и MySQL:

<pre>
# <strong>env FLAVOR="ldap mysql" make install clean CLEANDEPENDS=Yes</strong>
</pre>

<p>
Программу maildrop также можно установить с помощью прекомпилированного пакета:

<pre>
# <strong>pkg_add ftp://ftp.openbsd.org/pub/OpenBSD/3.8/packages/i386/courier-utils-1.7.0p2.tgz</strong>
</pre>

<p>
Редактируем главный конфигурационный файл MDA:

<pre>
# <strong>vi /etc/maildroprc</strong>

# Секция общих настроек.
#
SHELL="/bin/sh"
SENDMAIL="/usr/sbin/sendmail"

# Включаем журналирование событий.
#
logfile "$DEFAULT/maildrop.log"
VERBOSE=9

# Задаем хранилище сообщений формата Maildir.
#
DEFAULT="$HOME/Maildir"

# Входящую корреспонденцию можно резервировать в файлы формата mbox.
#
#cc "/var/mail/$LOGNAME"

# Складываем почту в ~/Maildir.
#
to $DEFAULT
</pre>

<p>
Для пользователей создаем шаблон директории Maildir:

<pre>
# <strong>maildirmake /etc/skel/Maildir</strong>
# <strong>maildirmake -f Draft /etc/skel/Maildir</strong>
# <strong>maildirmake -f Sent /etc/skel/Maildir</strong>
# <strong>maildirmake -f Trash /etc/skel/Maildir</strong>
</pre>

<p>
Переходим в каталог с примерами конфигурационных mc-файлов:

<pre>
# <strong>cd /usr/share/sendmail/cf</strong>
</pre>

<p>
Изменяем локальный агент доставки почты с mail.local(8) на maildrop:

<pre>
# <strong>vi server.mc</strong>
FEATURE(local_procmail, `/usr/local/bin/maildrop', `maildrop -d $u')dnl
MAILER(local)dnl
MAILER(smtp)dnl
</pre>

<p>
Пересобираем mc-файл, предварительно сделав копию исходного sendmail.cf:

<pre>
# <strong>cp /etc/mail/sendmail.cf /etc/mail/sendmail.cf.bak</strong>
# <strong>m4 ../m4/cf.m4 server.mc > /etc/mail/sendmail.cf</strong>
</pre>

<p>
Запускаем sendmail(8):

<pre>
# <strong>/usr/sbin/sendmail -L sm-mta -bd -q30m</strong>
</pre>

<p>
Либо заставляем демона перечитать свой cf-конфиг:

<pre>
# <strong>kill -HUP `head -1 /var/run/sendmail.pid`</strong>
</pre>

</td></tr>
</table>

<p>
<hr>
<a href="javascript:if(confirm('http://www.openbsd.ru/docs/steps/index.html  \n\nThis file was not retrieved by Teleport Ultra, because it is linked too far away from its Starting Address. If you increase the in-domain depth setting for the Starting Address, this file will be queued for retrieval.  \n\nDo you want to open it from the server?'))window.location='http://www.openbsd.ru/docs/steps/index.html'" tppabs="http://www.openbsd.ru/docs/steps/index.html"><img height=24 width=24 src="back.gif" tppabs="http://www.openbsd.ru/images/back.gif" alt="OpenBSD.ru"></a>
<a href="mailto:www@openbsd.ru">www@openbsd.ru</a>
<br>
<small>$RuOBSD: maildrop.html,v 1.10 2010/11/01 10:57:48 dinar Exp $</small>

</body>
</html>
