<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=koi8-r">
<meta http-equiv="Content-Language" content="ru">
<meta name="copyright" content="Copyright (c) 2005 by OpenBSD.ru">
<title>VPN: Настройка PPTP-клиента</title>
<link rel="stylesheet" type="text/css" href="style.css" tppabs="http://www.openbsd.ru/style.css">
</head>

<body>

<h2>VPN: Настройка PPTP-клиента</h2>
<hr>

<h3>Мини-руководство "шаг за шагом"</h3>

<p>
<table border=0>
<tr><td>

<p>
Пример настройки клиента VPN на основе протокола PPTP с использованием метода
аутентификации MSChapV2 и шифрованием MPPE-128. Предположим, что VPN-сервер
имеет IP-адрес 192.168.1.1, выданы логин &quot;test&quot; и пароль
&quot;qwe123&quot;.

<p>
Разрешаем использование протокола GRE:

<pre>
# <strong>sysctl -w net.inet.gre.allow=1</strong>
</pre>

<p>
Добавляем соответствующую запись в <span>/etc/sysctl.conf</span>:

<pre>
# <strong>vi /etc/sysctl.conf</strong>
net.inet.gre.allow=1
</pre>

<p>
Устанавливаем <span>pptp-client</span> из портов:

<pre>
# <strong>cd /usr/ports/net/pptp</strong>
# <strong>make install clean</strong>
</pre>

<p>
Или с помощью прекомпилированного пакета:

<pre>
# <strong>pkg_add ftp://ftp.openbsd.org/pub/OpenBSD/3.8/packages/i386/pptp-1.6.0.tgz</strong>
</pre>

<p>
Перейдем к настройке PPP. Обратите внимание, что в файле
<span>/etc/ppp/ppp.conf</span> cтроки, оканчивающиеся на
``:'', вводятся без отступа в начале строки. Остальные строки должны быть
введены с отступом, как показано в примере.

<pre>
# <strong>vi /etc/ppp/ppp.conf</strong>
default:
  set log Phase Chat LCP IPCP CCP tun command
  disable ipv6cp

pptp:
  # используем pptp-клиент как источник данных для ppp
  set device "!/usr/local/sbin/pptp 192.168.1.1 --nolaunchpppd"
  # отключаем таймер ожидания
  set timeout 0
  # выставляем значения других таймеров
  set lqrperiod 5
  set cd 5
  set redial 30
  # параметры аутентификации
  set authname test
  set authkey qwe123
  set dial
  set login
  # используем алгоритм шифрования данных MPPE
  set mppe 128 stateless
  # используем MS-CHAP V2
  accept MSChapV2
  # включаем использование протокола LQR
  enable lqr
  # MSS туннельного интерфейса не должно превышать MTU физического
  enable mssfixup
  # отключаем метод сжатия адресов и некоторых полей
  disable acfcomp protocomp
  deny acfcomp
  # добавить маршрут по умолчанию
  add! default HISADDR
</pre>

<p>
Выставляем корректные права доступа:

<pre>
# <strong>chmod 600 /etc/ppp/ppp.conf</strong>
</pre>

<p>
Проверяем:

<pre>
# <strong>ppp -ddial pptp</strong>
</pre>

<p>
Если тестирование прошло успешно, можно настроить автоматичекое поднятие
VPN-соединения в момент старта системы:

<pre>
# <strong>vi /etc/hostname.tun0</strong>
!/usr/sbin/ppp -ddial pptp &gt;/dev/null 2&gt;&amp;1
</pre>

<p>
Статья основана на материалах, предоставленных Гнединым Алексеем aka Goblin.

</td></tr>
</table>

<p>
<hr>
<a href="javascript:if(confirm('http://www.openbsd.ru/docs/steps/index.html  \n\nThis file was not retrieved by Teleport Ultra, because it is linked too far away from its Starting Address. If you increase the in-domain depth setting for the Starting Address, this file will be queued for retrieval.  \n\nDo you want to open it from the server?'))window.location='http://www.openbsd.ru/docs/steps/index.html'" tppabs="http://www.openbsd.ru/docs/steps/index.html"><img height=24 width=24 src="back.gif" tppabs="http://www.openbsd.ru/images/back.gif" alt="OpenBSD.ru"></a>
<a href="mailto:www@openbsd.ru">www@openbsd.ru</a>
<br>
<small>$RuOBSD: pptp-client.html,v 1.11 2010/11/01 10:57:49 dinar Exp $</small>

</body>
</html>
