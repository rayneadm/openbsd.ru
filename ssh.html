<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=koi8-r">
<meta http-equiv="Content-Language" content="ru">
<meta name="copyright" content="Copyright (c) 2000-2004 by OpenBSD.ru">   
<title>RSA/DSA аутентификация в OpenSSH</title>
<link rel="stylesheet" type="text/css" href="style.css" tppabs="http://www.openbsd.ru/style.css" />
</head>

<body>

<h2>RSA/DSA аутентификация в OpenSSH</h2>
<hr>

<h3>Что это такое?</h3>

<p>
OpenSSH - замена стандартных уязвимых протоколов, таких как telnet или rsh.
OpenSSH использует шифрованный канал для передачи данных. В нем могут быть
задействованы алгоритмы аутентификации RSA или DSA.

<p>
Эти протоколы основаны на базе специально созданной паре ключей, а именно
публичном и приватном ключах. Это асимметричные алгоритмы шифрования, то есть
мы можем зашифровать информацию одним ключом, а расшифровать другим, в отличие,
например от DES, где используется один и тот же ключ для шифрования и
расшифровки информации.

<p>
Первым делом следует сгенеровать пару ключей. Опцией <strong>-t</strong> мы
задаём тип ключа. Доступны следующие типы ключей: <strong>rsa</strong>,
<strong>dsa</strong> для протокола SSH 2 и <strong>rsa1</strong> для SSH 1.

<pre>
	$ <b>ssh-keygen -t dsa</b>
	Generating public/private dsa key pair.
	Enter file in which to save the key (/home/dfa/.ssh/id_dsa):
	Enter passphrase (empty for no passphrase):
	Enter same passphrase again:
	Your identification has been saved in /home/dfa/.ssh/id_dsa.
	Your public key has been saved in /home/dfa/.ssh/id_dsa.pub.
	The key fingerprint is:
	27:33:40:91:0f:81:df:0a:87:f5:58:60:bb:28:c8:ad dfa@zinc
</pre>

<p>
Далее, если необходимо, указываем место, куда сохранить ключ, по умолчанию
предлагается <strong>/home/$USER/.ssh/id_dsa</strong>. Если ввести пароль,
наш приватный ключ будет зашифрован, и для того чтобы позднее воспользоваться
этим ключом, нам необходимо будет вводить данный пароль. Публичный ключ имеет
суффикс <strong>.pub</strong>.

<p>
При использовании беспарольной аутентификации любой, кто имеет доступ к
приватному ключу, может беспрепятственно проникнуть на удалённую машину,
для которой этот ключ используется.

<p>
Публичный ключ не представляет угрозу для безопасности, мы можем пересылать
его по email или по ftp.

<p>
Далее рассмотрим способ аутентификации, при котором приватный ключ будет
зашифрован паролем, и нам не нужно будет каждый раз вводить его при соединении,
за нас это будет делать <a href="#agent">ssh-agent</a>, занимающийся
кэшированием дешифрованных личных ключей.

<h3>Беспарольная аутентификация</h3>

<p>После успешной генерации ключей необходимо скопировать публичный ключ
на удалённую машину в файл <span>~/.ssh/authorized_keys</span>:

<pre>
	$ <b>scp ~/.ssh/id_dsa.pub cvs.openbsd.ru:~/.ssh/authorized_keys</b>
	dfa@cvs.openbsd.ru password:
	id_dsa.pub         100% |***************************|   598     00:00
</pre>

<p>Пример файла конфигурации клиента <strong>~/.ssh/config</strong>:

<pre>
	Host cvs.openbsd.ru
		IdentityFile ~/.ssh/id_dsa
		RSAAuthentication yes

	Host anoncvs.ca.openbsd.org
		Compression no

	Host *
		Cipher blowfish
		Compression yes
		EscapeChar ~
		Port 22
		Protocol 2,1
		User dfa
</pre>

<p>
Пробуем присоединиться к удалённой машине <strong>cvs.openbsd.ru</strong>

<pre>
	$ <b>ssh cvs.openbsd.ru</b>
	OpenBSD 3.0-current (RUOBSD) #19: Sat Dec  1 11:57:43 NOVT 2001

	Welcome to OpenBSD: The proactively secure Unix-like operating system.

	$
</pre>

<a name="agent"></a>
<h3>Парольная аутентификация с использованием ssh-agent</h3>

<p>
ssh-agent - специальная программа-демон, которая разработана для протоколов
аутентификации RSA/DSA и применяется для хранения парольной фразы приватного
ключа. Используя эту программу, вы можете соединяться с удалённой машиной, не
набирая пароль, и при этом ваши приватные ключи остаются защищёнными. Клиент
ssh поддерживает ssh-agent и может взаимодействовать с ней.

<p>
Ключи и их пароли добавляются к ssh-agent только один раз, используя ssh-add,
и далее ssh будет обращаться к ssh-agent для определения парольной фразы для
данного приватного ключа.

<p>
При запуске ssh-agent, в зависимости от вашего $SHELL, выводит команды для
установки переменных окружения:

<pre>
	$ <b>ssh-agent</b>
	SSH_AUTH_SOCK=/tmp/ssh-jyw17290/agent.17290; export SSH_AUTH_SOCK;
	SSH_AGENT_PID=8809; export SSH_AGENT_PID;
	echo Agent pid 8809;
	$
</pre>

<p>
ssh-agent открывает сокет для взаимодействия с ssh и сообщает об этом через
переменную окружения $SSH_AUTH_SOCK, а также сообщает свой уникальный
идентификатор процесса, который установлен в переменной окружения
$SSH_AGENT_PID и выводится командой echo.

<p>
Правильный запуск ssh-agent, используя встроенную в оболочку команду eval,
выполняется следующим образом:

<pre>
	$ <b>eval `ssh-agent`</b>
	Agent pid 17522
	$
</pre>

<p>
Или можно задать программу, использующую ssh, как аргумент ssh-agent. В данном
случае - это командный интерпретатор ksh:

<pre>
	$ <b>ssh-agent /bin/ksh</b>
	$ <b>env | grep SSH</b>
	SSH_AUTH_SOCK=/tmp/ssh-SAe17087/agent.17087
	SSH_AGENT_PID=20652
	$
</pre>

<p>
Теперь, используя ssh-add, необходимо добавить ключ и парольную фразу к нему:

<pre>
	$ <b>ssh-add ~/.ssh/id_dsa</b>
	Enter passphrase for /home/dfa/.ssh/id_dsa:
	Identity added: /home/dfa/.ssh/id_dsa (/home/user/.ssh/id_dsa)
	$
</pre>

<p>
Пробуем присоединиться к удалённой машине <strong>cvs.openbsd.ru</strong>

<pre>
	$ <b>ssh cvs.openbsd.ru</b>
	OpenBSD 3.0-current (RUOBSD) #19: Sat Dec  1 11:57:43 NOVT 2001

	Welcome to OpenBSD: The proactively secure Unix-like operating system.

	$
</pre>

<p>
<hr>
<a href="index-1.html" tppabs="http://www.openbsd.ru/docs/index.html"><img height=24 width=24 src="back.gif" tppabs="http://www.openbsd.ru/images/back.gif" alt="OpenBSD.ru"></a>
<a href="mailto:www@openbsd.ru">www@openbsd.ru</a>
<br>
<small>$RuOBSD: ssh.html,v 1.26 2010/11/01 10:57:47 dinar Exp $</small>

</body>
</html>
