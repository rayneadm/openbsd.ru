<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=koi8-r">
<meta http-equiv="Content-Language" content="ru">
<meta name="copyright" content="Copyright (c) 2005 by OpenBSD.ru">
<title>OpenSSL: 101 прием работы</title>
<link rel="stylesheet" type="text/css" href="../../style.css">
</head>

<body>

<h2>OpenSSL: 101 прием работы</h2>
<hr>

<h3>Мини-руководство "шаг за шагом"</h3>

<p>
<table border=0>
<tr><td>

<p>
Пример шифрования файла симметричным алгоритмом des3 с помощью <tt>openssl enc</tt>:

<pre>
% <strong>openssl enc -des3 -e -in plain.txt -out enc.txt</strong>
enter des-ede3-cbc encryption password:
Verifying - enter des-ede3-cbc encryption password:
</pre>

<p>
Расшифровать файл можно, заменив ключ '-e' ключом '-d':

<pre>
% <strong>openssl enc -des3 -d -in enc.txt -out plain.txt</strong>
enter des-ede3-cbc decryption password:
</pre>

<p>
Для того, чтобы собеседник мог передать нам файл в зашифрованном виде, а мы бы
смогли его расшифровать, стоит воспользоваться ассиметричной криптографией,
сгенерировав пару RSA-ключей (публичный и приватный):

<pre>
% <strong>openssl genrsa -out rsaprivatekey.pem -des3 2048</strong>
Generating RSA private key, 2048 bit long modulus
.................+++
................+++
e is 65537 (0x10001)
Enter pass phrase for rsaprivatekey.pem:
Verifying - Enter pass phrase for rsaprivatekey.pem:
</pre>

<p>
Выставляем корректные права доступа:

<pre>
% <strong>chmod 600 rsaprivatekey.pem</strong>
</pre>

<p>
Получить соответствующий закрытому публичный ключ можно с помощью <tt>openssl rsa</tt>:

<pre>
% <strong>openssl rsa -in rsaprivatekey.pem -pubout -out rsapublickey.pem</strong>
Enter pass phrase for rsaprivatekey.pem:
writing RSA key
</pre>

<p>
Публичный ключ мы передаем собеседнику. Он шифрует файл на нем, используя
<tt>openssl rsautl</tt>:

<pre>
% <strong>openssl rsautl -encrypt -pubin -inkey rsapublickey.pem -in plain.txt -out cipher.txt</strong>
</pre>

<p>
Мы получаем файл, расшифровываем его, используя свой секретный ключ:

<pre>
% <strong>openssl rsault -decrypt -inkey rsaprivatekey.pem -in cipher.txt -out plain.txt</strong>
</pre>

<p>
Кроме шифрования, можно также подписывать файлы, предоставляя гарантии, что
данный файл послан лично нами, и давая возможность проверить его аутентичность:

<pre>
% <strong>openssl dgst -sha1 -sign rsaprivatekey.pem -out sign.txt myfile.tar.gz</strong>
</pre>

<p>
Все, что нужно получателю файла - это проверить подпись, используя наш
публичный ключ:

<pre>
% <strong>openssl dgst -sha1 -verify rsapublickey.pem -signature sign.txt myfile.tar.gz</strong>
Verified OK.
</pre>

<p>
Вычислить контрольную сумму файла можно с помощью <tt>openssl dgst</tt>:

<pre>
% <strong>openssl dgst -md5 myfile.tar.gz</strong>
MD5(myfile.tar.gz) =65b36f8d54b8bab0a787cbd4a8dd8aef
</pre>

<p>
Чтобы быстро сгенерировать пароль, WEP или IPsec-ключи, можно воспользоваться
<tt>openssl rand</tt>:

<pre>
% <strong>openssl rand -base64 45</strong>
0JZmfHQL3WI7PTUYcq1w8yQ8wFE3mB7Wd7vdAYd2A6x0cTHmVYqI/Su3o5qh
</pre>

<p>
Если нужно найти соответствие пароля его md5-шифру, можно использовать
<tt>openssl passwd</tt>:

<pre>
% <strong>openssl passwd -1 mypassword</strong>
$1$OsmexMtO$0CtV.Lb6nhGOSGKM8jKNO.
</pre>

<p>
Пример подписи почтового сообщения своим сертификатом:

<pre>
% <strong>openssl smime -sign -signer server.crt -inkey server.key \
	-in message.txt -text | mail mailbox@domain.ru</strong>
</pre>

<p>
А теперь еще зашифруем:

<pre>
% <strong>openssl smime -encrypt -in message.txt -signer server.crt \
	-inkey server.key -text | openssl smime -encrypt \
	-des3 myserver.crt -out mail.msg | mail mailbox@domain.ru</strong>
</pre>

<p>
Чтобы протестировать работу сетевого сервиса, который работает через SSL,
выполним:

<pre>
% <strong>openssl s_client -connect myserver:443</strong>
</pre>

<p>
Статья основана на материалах, предоставленных Антоном Карповым
<a href="http://www.toxahost.ru/">www.toxahost.ru</a>.

</td></tr>
</table>

<p>
<hr>
<a href="index.html"><img height=24 width=24 src="../../images/back.gif" alt="OpenBSD.ru"></a>
<a href="mailto:www@openbsd.ru">www@openbsd.ru</a>
<br>
<small>$RuOBSD: openssl.html,v 1.8 2010/11/01 10:57:48 dinar Exp $</small>

</body>
</html>
